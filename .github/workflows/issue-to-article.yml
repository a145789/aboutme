name: Issue to Article

on:
  issues:
    types: [opened, edited, labeled, unlabeled]

concurrency:
  group: issue-to-article-${{ github.event.issue.number }}
  cancel-in-progress: true

jobs:
  create-article:
    if: (
      github.event.action != 'labeled' && github.event.action != 'unlabeled'
    ) || contains(fromJson('["blog","record"]'), github.event.label.name)
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
      issues: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22'

      - name: Setup
        run: npm i -g pnpm

      - name: Install
        run: pnpm install --no-frozen-lockfile

      - name: Create article from issue
        id: create-article
        run: node .github/scripts/create-article-from-issue.js
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Display article creation info
        run: |
          echo "âœ… Article creation completed!"
          echo "ğŸ“„ Article file: ${{ steps.create-article.outputs.file-path }}"
          echo "ğŸ“‚ Article category: ${{ steps.create-article.outputs.article-category }}"
          echo "ğŸ”— Pull Request: ${{ steps.create-article.outputs.pull-request-url }}"
          echo "ğŸ“ Issue #${{ steps.create-article.outputs.issue-number }} has been updated with PR link"
