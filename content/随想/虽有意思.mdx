---
createdAt: 2023/03/23 24:10
---

# åˆè¡·

å¼€å‘ `React` é¡¹ç›®çš„æ—¶å€™ï¼Œæ¯æ¬¡å†™ `useState` éƒ½è§‰å¾—å¾ˆéº»çƒ¦ï¼Œæ¯å®šä¹‰ä¸€ä¸ª `state` å°±è¦è·Ÿä¸€ä¸ª `setState` ä½œä¸ºå…±åŒè§£æ„å€¼ï¼Œå®šä¹‰ä¸€ä¸ªä¸¤ä¸ªè¿˜å¥½è¯´ï¼Œä½†èº«ä¸ºè‹¦é€¼çš„æ¬ç –ä»”ï¼Œé¢å¯¹å¤´ç–¼çš„ä¸šåŠ¡å·²ç»å¾ˆç—›è‹¦äº†ï¼Œå®šä¹‰ä¸ª `state` å°±ä¸èƒ½è®©æˆ‘æ›´è½»æ¾ç‚¹ï¼Ÿ

ä¸€æ—¥åœ¨ç”¨ `html` æ–‡ä»¶å†™ä¸€ä¸ªå° `demo` çš„æ—¶å€™ï¼Œä¸€ä¸ªé—å¿˜å·²ä¹…çš„[å°æŠ€å·§](https://code.visualstudio.com/docs/editor/emmet)ç»™äº†æˆ‘çµæ„Ÿï¼Œæˆ‘ä¸ºä»€ä¹ˆä¸å†™ä¸€ä¸ª `vscode` æ’ä»¶å¸®æˆ‘å¿«é€Ÿç”Ÿæˆ `useState`ã€‚

![emmet](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ebe1494a18f942b3ac9c35ed9fba060e~tplv-k3u1fbpfcp-zoom-1.image)

# æƒ³æ³•

æœ‰äº†æƒ³æ³•åï¼Œæˆ‘å¿«é€Ÿæœäº†ä¸€ä¸‹ `vscode` ç›¸å…³çš„å®ç°ï¼Œè¿™åº”è¯¥å±äºä»£ç ç‰‡æ®µçš„åŠŸèƒ½ï¼Œ`vscode` å†…ç½®çš„[snippets](https://code.visualstudio.com/docs/editor/userdefinedsnippets) åªæä¾›é™æ€ç”Ÿæˆï¼Œä½†æˆ‘ä»¬éœ€è¦æ ¹æ®ä¸åŒçš„ `state` åç§°å»ç”Ÿæˆä»£ç ã€‚

```js
const [name, setName] = useState("John")

const [count, setCount] = useState(0)
```

æ‰€ä»¥å¿…é¡»ä½¿ç”¨ `vscode` å†…ç½®çš„ `api` å»åŠ¨æ€ç”Ÿæˆä»£ç ã€‚

æ’ä»¶çš„åŠŸèƒ½ç»†èŠ‚ä¸ºå½“é”®å…¥ `const ` åå¯¹åé¢çš„å­—ç¬¦åšè§£æï¼Œé€šè¿‡ `/` åˆ†å‰²ä»£ç ï¼Œç¬¬ä¸€æ®µå­—ç¬¦ä¸º `state` åç§°ï¼Œç¬¬äºŒä¸ªä¸º `ts` ç±»å‹ï¼Œç¬¬ä¸‰ä¸ªåˆ™ä¸ºå€¼ï¼Œå¦‚æœæ²¡æœ‰ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œåˆ™ç¬¬äºŒä¸ªå‚æ•°ä¸ºå€¼ã€‚

```ts
// input
const count/0
// output
const [count, setCount] = useState(0)

// input
const name/string/'John'
// output
const [name, setName] = useState<string>('John')

// input
const arr/number[]/[]
// output
const [arr, setArr] = useState<number[]>([])

// input
const fooBar/Foo | Bar/'foo'
// output
const [fooBar, setFooBar] = useState<Foo | Bar>('foo')
```

## registerCompletionItemProvider

`vscode` æä¾›äº†ä¸€ä¸ª [registerCompletionItemProvider api](https://code.visualstudio.com/api/references/vscode-api#:~:text=registerCompletionItemProvider) å¯ä»¥è®©æˆ‘ä»¬ç»™ä»£ç æç¤ºåŠŸèƒ½æ³¨å…¥æƒ³æ·»åŠ çš„ä»£ç æ–‡æœ¬

![registerCompletionItemProvider](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e1ac267c7172492da138f0297d810c7d~tplv-k3u1fbpfcp-watermark.image?)

`registerCompletionItemProvider` æ¥å—ä¸‰ä¸ªå‚æ•°

- ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºåœ¨ä½•ç§æ–‡ä»¶æ ¼å¼ä¸‹è§¦å‘æ­¤å‡½æ•°
- ç¬¬äºŒä¸ªå‚æ•°ä¸ºæ³¨å…¥å‡½æ•°çš„å¯¹è±¡åˆé›†ï¼Œä¼ å…¥ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…æ‹¬ä¸¤ä¸ªå‡½æ•°
  - `provideCompletionItems` åœ¨é”®å…¥ä¸€ä¸ªå­—ç¬¦æ—¶è§¦å‘ï¼Œç”¨æˆ·å¯åœ¨æ­¤é˜¶æ®µå‘ä»£ç æç¤ºæä¾›ä»£ç æ–‡æœ¬
  - `resolveCompletionItem` å½“é€‰ä¸­æ­¤ä»£ç æç¤ºæ—¶çš„è§¦å‘åŠ¨ä½œ
- ç¬¬ä¸‰ä¸ªå‚æ•°å‰©ä½™å‚æ•°ï¼Œè¯¥å‡½æ•°è§¦å‘çš„å­—ç¬¦ï¼Œä¸€èˆ¬æ¥è¯´é”®å…¥ä¸€ä¸ªè‹±æ–‡å­—ç¬¦ä¼šé»˜è®¤è§¦å‘ï¼Œä½†æ˜¯æ•°å­— `.` `/` ç­‰å­—ç¬¦éœ€è¦æ‰‹åŠ¨æŒ‡å®š

```js
// åœ¨ html æ–‡ä»¶ä¸‹è§¦å‘ï¼Œé‡åˆ° . - å­—ç¬¦è¿›è¡Œä»£ç æç¤º
const disposable = vscode.languages.registerCompletionItemProvider(
  "html",
  {
    provideCompletionItems() {},
    resolveCompletionItem() {},
  },
  ".",
  "-"
)
```

# å®ç°

å¦‚ä½•åˆ›å»ºä¸€ä¸ª `vscode` æ’ä»¶é¡¹ç›®å°±ä¸è¯´äº†ï¼Œæ˜é‡‘æœ‰å¾ˆå¤šç¤ºä¾‹ï¼Œæ¨èè¿™ä¸ª[æ–‡ç« ](https://juejin.cn/post/7119095066810908679)ï¼Œæœ¬æ’ä»¶çš„ä»£ç ä¹Ÿå‚è€ƒäº†è¿™ä¸ª[åº“](https://github.com/jaluik/dot-log)ã€‚

`vscode` æ’ä»¶éœ€è¦é€šè¿‡ `package.json` ä¸­çš„ `activationEvents` å‚æ•°æŒ‡å®šè¯¥æ’ä»¶åœ¨ä»€ä¹ˆæƒ…å†µä¸‹è§¦å‘

```json
// package.json
{
  //...
  "activationEvents": [
    "onLanguage:html",
    "onLanguage:vue",
    "onLanguage:javascript",
    "onLanguage:typescript",
    "onLanguage:javascriptreact",
    "onLanguage:typescriptreact"
  ]
  //   ...
}
```

åœ¨é‡åˆ° `html vue js ts jsx tsx` æ–‡ä»¶æ—¶è§¦å‘è¯¥æ’ä»¶(å¤šæ”¯æŒå‡ ä¸ªæ–‡ä»¶ï¼Œè°è¯´ä¸èƒ½åœ¨ `vue` æ–‡ä»¶é‡Œå†™ `useState` å‘¢[ç‹—å¤´])ã€‚

æ ¸å¿ƒé€»è¾‘åœ¨ `/src/extension.ts` æ–‡ä»¶ä¸­ï¼Œå¯¼å‡ºä¸€ä¸ª `activate` å‡½æ•°ï¼Œåœ¨æ­¤å‡½æ•°ä¸­æ·»åŠ åŠŸèƒ½

```ts
const TRIGGER_CHARACTERS = [
  "{",
  "}",
  "[",
  "]",
  "/",
  "'",
  '"',
  "0",
  "1",
  "2",
  "3",
  "4",
  "5",
  "6",
  "7",
  "8",
  "9",
]
export function activate(context: vscode.ExtensionContext) {
  const disposable = vscode.languages.registerCompletionItemProvider(
    [
      "javascript",
      "javascriptreact",
      "typescript",
      "typescriptreact",
      "vue",
      "html",
    ],
    new MyCompletionItemProvider(),
    ...TRIGGER_CHARACTERS
  )

  context.subscriptions.push(disposable)
}
```

`TRIGGER_CHARACTERS` ä¸ºè§¦å‘å­—ç¬¦ï¼Œæˆ‘ä»¬æŠŠæ ¸å¿ƒé€»è¾‘åŒ…è£…åˆ° `MyCompletionItemProvider` ä¸­ã€‚

`provideCompletionItems` æ¥å— `vscode` ä¼ å…¥çš„å½“å‰ `æ–‡æ¡£(document)` å’Œ `å½“å‰å…‰æ ‡ä½ç½®(position)` ä¸¤ä¸ªå‚æ•°ï¼Œé€šè¿‡è¿™ä¸¤ä¸ªå‚æ•°å¾—åˆ°å½“å‰è¡Œè¾“å…¥çš„æ–‡æœ¬ï¼Œå¯¹æ–‡æœ¬è¿›ä¸€æ­¥è§£æï¼Œç”Ÿæˆæˆ‘ä»¬æƒ³è¦çš„ä»£ç ç‰‡æ®µï¼Œç„¶åé€šè¿‡ `new vscode.CompletionItem` ç”Ÿæˆä¸€ä¸ªä»£ç æç¤ºå®ä¾‹ï¼Œ`return` å‡ºå»

```ts
class MyCompletionItemProvider implements vscode.CompletionItemProvider {
  private position?: vscode.Position
  private str = ""

  constructor() {}

  // æä¾›ä»£ç æç¤ºçš„å€™é€‰é¡¹
  public provideCompletionItems(
    document: vscode.TextDocument,
    position: vscode.Position
  ) {
    this.position = position

    const linePrefix = document
      .lineAt(position)
      .text.slice(0, position.character)

    // å¦‚æœæ–‡æœ¬å‰ç¼€ä¸ä¸º const ï¼Œåˆ™ä¸åšæç¤º
    if (!linePrefix?.startsWith("const ") || !linePrefix.split("const ")[1]) {
      this.str = ""
      return []
    }

    // ... çœç•¥æ–‡æœ¬è§£æè¿‡ç¨‹ï¼Œè¯¦ç»†å¯å‚è€ƒä»£ç ä»“åº“

    const snippetCompletion = new vscode.CompletionItem(
      linePrefix,
      vscode.CompletionItemKind.Snippet
    )

    snippetCompletion.documentation = this.str
    snippetCompletion.detail = "quickly generate useState"
    return [snippetCompletion]
  }

  public resolveCompletionItem(item: vscode.CompletionItem) {
    const label = item.label
    if (this.position && typeof label === "string") {
      // å½“é€‰ä¸­æ­¤ä»£ç æç¤ºæ—¶ï¼Œå‘èµ·ä¸€ä¸ª `vscode-extension.quick-useState` å‘½ä»¤
      item.command = {
        command: "vscode-extension.quick-useState",
        title: "refactor",
        arguments: [this.position.translate(0, label.length + 1), this.str],
      }
    }

    return item
  }
}

export function activate(context: vscode.ExtensionContext) {
  // åœ¨ activate å‡½æ•°ä¸­æ·»åŠ ä¸€ä¸ª vscode-extension.quick-useState å‘½ä»¤
  // è§¦å‘æ­¤å‘½ä»¤æ‰§è¡ŒæŸäº›æ“ä½œ
  const commandId = "vscode-extension.quick-useState"
  const commandHandler = (
    editor: vscode.TextEditor,
    edit: vscode.TextEditorEdit,
    position: vscode.Position,
    str: string
  ) => {
    const lineText = editor.document.lineAt(position.line).text
    // åˆ é™¤å½“å‰è¡Œ
    edit.delete(
      new vscode.Range(
        position.with(undefined, 0),
        position.with(undefined, lineText.length)
      )
    )
    // æ’å…¥ä»£ç æç¤ºçš„ç‰‡æ®µ
    edit.insert(position.with(undefined, 0), str)

    return Promise.resolve([])
  }
  context.subscriptions.push(
    vscode.commands.registerTextEditorCommand(commandId, commandHandler)
  )

  // ...
}
```

æ•´ä½“çš„æµç¨‹ä¸ºé”®å…¥å­—ç¬¦ï¼Œè§¦å‘ `provideCompletionItems` å‡½æ•°ï¼Œä¸ºä»£ç æç¤ºæ‚¬æµ®æ¡†æ’å…¥ä¸€ä¸ªä»£ç æç¤ºï¼Œé€‰æ‹©æ­¤æç¤ºï¼Œè§¦å‘ `resolveCompletionItem` å‡½æ•°ï¼Œåœ¨æ­¤å‡½æ•°ä¸­å‘èµ·ä¸€ä¸ªå‘½ä»¤ï¼Œè¯¥å‘½ä»¤æŒ‡å‘çš„æ“ä½œåˆ é™¤æ–‡æœ¬ï¼Œæ’å…¥æƒ³è¦çš„æ–‡æœ¬ã€‚æ’ä»¶çš„æ•ˆæœä¹Ÿå°±å®Œæˆäº†ã€‚

![æ•ˆæœ](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/76e296f370b34d0ba5ff354b0d108599~tplv-k3u1fbpfcp-watermark.image?)

å®ç°çš„æ ¸å¿ƒé€»è¾‘åœ¨æ­¤å°±ä¸èµ˜è¿°äº†ï¼Œå¾ˆç®€å•çš„ä¸€ä¸ªæ–‡æœ¬è§£æï¼Œå¯ä»¥ç‚¹å‡»[æ­¤å¤„ GitHub æŸ¥çœ‹](https://github.com/a145789/vscode-quick-useState/blob/86d2c44bc9e0b72b8de745a1645deb8cdceec18e/src/extension.ts#L28)ã€‚

# å‘

é€šè¿‡è¿™æ¬¡å†™æ’ä»¶ä¹Ÿè¸©äº†ä¸å°‘å‘ï¼Œä¸è¿‡æœ€å¤§åŸå› è¿˜æ˜¯è‹±è¯­èƒ½åŠ›ä¸è¡Œï¼Œæ’ä»¶ `api` æ–‡æ¡£éƒ½æ˜¯è‹±è¯­ï¼Œç¿»è¯‘å‡ºæ¥çš„ä¸­æ–‡ç®€ç›´ä¸æ˜¯äººè¯ï¼Œåªèƒ½è‡ªå·±å¯»æ‘¸ï¼Œæˆ–è€…æ‰¾ç±»ä¼¼çš„åº“å‚è€ƒå®ç°ã€‚

æ­¤å¤–å°±æ˜¯ `registerCompletionItemProvider` å‡½æ•°çš„è§¦å‘æ—¶æœºï¼Œå‰æ–‡æœ‰è®²åˆ°ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ `vscode` åªä¼šåœ¨è‹±æ–‡å­—ç¬¦ä¸‹å‡ºç°ä»£ç æç¤ºï¼Œå¦‚æœæƒ³åœ¨é”®å…¥ `0` æˆ–è€… `-` ç­‰å­—ç¬¦ä¹Ÿå‡ºç°ä»£ç æç¤ºæ‚¬æµ®æ¡†ï¼Œéœ€è¦ä½œä¸º `registerCompletionItemProvider` çš„ç¬¬ä¸‰ç¬¬å››ä¸ªå‚æ•°ä¼ å…¥ã€‚

ä»£ç æç¤ºæ‚¬æµ®æ¡†ç”±ä¸¤éƒ¨åˆ†ï¼Œå·¦ä¾§æ˜¯ä»£ç æç¤ºçš„ç®€ç•¥æ–‡æœ¬ï¼Œå³ä¾§æ˜¯è¯¦ç»†ä¿¡æ¯ï¼Œç®€ç•¥æ–‡æœ¬å°½é‡å’Œé”®å…¥çš„æ–‡æœ¬ä¿æŒä¸€è‡´ï¼Œå› ä¸º `vscode` ä¼šä¼˜å…ˆåŒ¹é…ä»£ç æç¤ºçš„ç®€ç•¥æ–‡æœ¬ï¼Œå¦‚æœç®€ç•¥æ–‡æœ¬ä¸­å«æœ‰æ­¤æ–‡æœ¬ï¼Œå°†ä¸ä¼šè§¦å‘ `registerCompletionItemProvider` å‡½æ•°ã€‚

å¸¦ä¸‰ä¸ªç‚¹å°±æ˜¯å‘å¸ƒæ’ä»¶æ—¶åˆ›å»ºå‘å¸ƒè€…å¦‚æœä½¿ç”¨[ç½‘é¡µæ–¹å¼](https://marketplace.visualstudio.com/manage)åˆ›å»ºè´¦å·ï¼Œè¦ä½¿ç”¨ç§‘å­¦ä¸Šç½‘ï¼Œä¸ç„¶æ²¡åŠæ³•æ­£ç¡®åˆ›å»ºï¼Œåˆ›å»ºçš„ `ID` è¦å’Œä½  `package.json` çš„ `publisher` å­—æ®µä¿æŒä¸€è‡´ï¼Œå¦åˆ™ä¼šæŠ¥é”™.

```json
// package.json
{
  // ...
  "publisher": "..."
  // ...
}
```

# æˆå“

æœ€ç»ˆæˆå“ æ”¾åœ¨è¿™é‡Œ

[GitHub åœ°å€](https://github.com/a145789/vscode-quick-useState)

[Visual Studio Code åº”ç”¨å¸‚åœº](https://marketplace.visualstudio.com/items?itemName=clencat.react-quick-useState)

æœ‰éœ€è¦çš„æœ‹å‹å¯ä»¥è¯•ä¸€ä¸‹ã€‚

æœ¬æ–‡æ­£åœ¨å‚åŠ [ã€Œé‡‘çŸ³è®¡åˆ’ . ç“œåˆ† 6 ä¸‡ç°é‡‘å¤§å¥–ã€](https://juejin.cn/post/7162096952883019783 "https://juejin.cn/post/7162096952883019783")

| Alpha | Bravo   |
| ----- | ------- |
| ä¸­æ–‡  | Charlie |
| ğŸ‘©â€â¤ï¸â€ğŸ‘©    | Delta   |

> asasccs
